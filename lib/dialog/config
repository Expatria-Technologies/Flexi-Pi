#!/bin/bash
### DO NOT EDIT
RED="\e[0;31m"
FIN="\e[0m"
useracct="0"
NAME=""
USERNAME=""
PASSWORD=""
rootpasswd="0"
VERSION="5.15.y"
BUILD_VERSION="1"
menuconfig="0"
crosscompile="1"
GCC_VERSION="gcc-10"
gcc="1"
ccache="0"
clang="0"
DISTRO="debian"
DISTRO_VERSION="bullseye"
ext4="1"
btrfs="0"
xfs="0"
custom_defconfig="0"
MYCONFIG=""
compress_img="0"

# open fd
exec 3>&1

# Store data to $VALUES variable
VALUES=$(dialog --ok-label "Submit" --no-cancel \
	  --backtitle "Raspberry Pi Image Builder" \
	  --title "Config Menu" \
	  --form "" \
0 36 0 \
	"User Service:" 1 1	"$useracct"		1 16 2 0 \
	""		2 1	""	 		2 14 0 0 \
	"Name:"		3 1	"$NAME" 		3 11 14 0 \
	"Username:"	4 1	"$USERNAME" 		4 11 14 0 \
	"Password:"	5 1	"$PASSWORD"  		5 11 14 0 \
	"Enable root:"	6 1	"$rootpasswd"  		6 14 2 0 \
	""		7 1	""	 		7 14 0 0 \
	"Linux kernel"	8 1	""	 		8 14 0 0 \
        "Branch:"   	9 1     "$VERSION"        	9 9 7 0 \
        "Build:"   	10 1     "$BUILD_VERSION"       10 8 4 0 \
	"Menuconfig:"	11 1	"$menuconfig"  		11 13 2 0 \
	"Crosscompile:" 12 1	"$crosscompile" 	12 15 2 0 \
	""		13 1	""	 		13 14 0 0 \
	"Compiler"	14 1	""	 		14 14 0 0 \
	"Version:"	15 1	"$GCC_VERSION"	 	15 10 8 0 \
	"GCC:"		16 1	"$gcc"		 	16 9 2 0 \
	"Ccache:"	17 1	"$ccache"	 	17 9 2 0 \
	"Clang:"	18 1	"$clang"	 	18 9 2 0 \
	""		19 1	""	 		19 14 0 0 \
	"Distribution"	20 1	""	 		20 14 0 0 \
	"Distro:"	21 1	"$DISTRO"	  	21 10 15 0 \
	"Release:"	22 1	"$DISTRO_VERSION"  	22 10 15 0 \
	""		23 1	""	 		23 14 0 0 \
	"Filesystem"	24 1	""	 		24 14 0 0 \
	"ext4:"		25 1	"$ext4"		 	25 8 2 0 \
	"btrfs:"	26 1	"$btrfs"	 	26 8 2 0 \
	"xfs:"		27 1	"$xfs"		 	27 8 2 0 \
	""		28 1	""	 		28 14 0 0 \
	"Customize"	29 1	""	 		29 14 0 0 \
	"Defconfig:"	30 1	"$custom_defconfig" 	30 12 2 0 \
	"Name:"		31 1	"$MYCONFIG"	  	31 7 20 0 \
	""		32 1	""	 		32 14 0 0 \
	"Options"	33 1	""	 		33 14 0 0 \
	"Compress img:"	34 1	"$compress_img" 	34 15 2 0 \
2>&1 1>&3)

# close fd
exec 3>&-

# convert into vars
echo "$VALUES" > tmp1
echo useracct= > tmp0
echo NAME='"' >> tmp0
echo USERNAME='"' >> tmp0
echo PASSWORD='"' >> tmp0
echo rootpasswd= >> tmp0
echo VERSION='"' >> tmp0
echo BUILD_VERSION='"' >> tmp0
echo menuconfig= >> tmp0
echo crosscompile= >> tmp0
echo GCC_VERSION='"' >> tmp0
echo gcc= >> tmp0
echo ccache= >> tmp0
echo clang= >> tmp0
echo DISTRO='"' >> tmp0
echo DISTRO_VERSION='"' >> tmp0
echo ext4= >> tmp0
echo btrfs= >> tmp0
echo xfs= >> tmp0
echo custom_defconfig= >> tmp0
echo MYCONFIG='"' >> tmp0
echo compress_img= >> tmp0
echo uscripts=0 >> tmp0
echo verbose=0 >> tmp0
echo CLANG_LLVM='"'LLVM=1 LLVM_IAS=1'"' >> tmp0
echo lto_clang_thin=0 >> tmp0
echo CORES=\`nproc\` >> tmp0
echo CFLAGS='"''"' >> tmp0
echo "set_locales(){" >> tmp0
echo "apt install -y locales" >> tmp0
echo "export LANGUAGE=en_US.UTF-8" >> tmp0
echo "export LANG=en_US.UTF-8" >> tmp0
echo "export LC_ALL=C.UTF-8" >> tmp0
echo "locale-gen en_US.UTF-8" >> tmp0
echo "}" >> tmp0
echo "set_timezone(){" >> tmp0
echo "ln -snf /usr/share/zoneinfo/America/New_York /etc/localtime" >> tmp0
echo "echo -n 'America/New_York' > /etc/timezone" >> tmp0
echo "}" >> tmp0
echo 'NAMESERVER1="8.8.8.8"' >> tmp0
echo 'NAMESERVER2="8.8.4.4"' >> tmp0
echo rtl8812au=0 >> tmp0
echo rtl88x2bu=0 >> tmp0
echo rtl8811cu=0 >> tmp0
echo builder=4.6 >> tmp0
echo > tmp2
echo '"' >> tmp2
echo '"' >> tmp2
echo '"' >> tmp2
echo >> tmp2
echo '"' >> tmp2
echo '"' >> tmp2
echo >> tmp2
echo >> tmp2
echo '"' >> tmp2
echo >> tmp2
echo >> tmp2
echo >> tmp2
echo '"' >> tmp2
echo '"' >> tmp2
echo >> tmp2
echo >> tmp2
echo >> tmp2
echo >> tmp2
echo _defconfig'"' >> tmp2
paste -d '\0' tmp0 tmp1 tmp2  > userdata.txt
rm -f tmp0 tmp1 tmp2

# categories
sed -i '6i### LINUX KERNEL' userdata.txt
sed -i '11i### COMPILER' userdata.txt
sed -i '16i### DISTRIBUTION' userdata.txt
sed -i '19i### FILESYSTEM' userdata.txt
sed -i '24i### CUSTOM' userdata.txt
sed -i '29i### CLANG/LLVM' userdata.txt
sed -i '32i### COMPILER TUNING' userdata.txt
sed -i '35i### LOCALES' userdata.txt
sed -i '43i### TIMEZONE' userdata.txt
sed -i '48i### NAME SERVER' userdata.txt
sed -i '51i### EXTRA WIRELESS' userdata.txt
sed -i '55i### DO NOT EDIT BELOW THIS LINE' userdata.txt

# clear screen
clear -x

# userdata
echo -e "${RED}userdata file created${FIN}."
