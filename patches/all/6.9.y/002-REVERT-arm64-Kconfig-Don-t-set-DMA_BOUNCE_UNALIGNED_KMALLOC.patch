From b9ad28c0de3fb2dc46283308de411eb013a132f1 Mon Sep 17 00:00:00 2001
From: Patrick Yavitz <pyavitz@xxxxx.com>
Date: Wed, 17 Apr 2024 12:55:18 -0400
Subject: [PATCH] REVERT: arm64/Kconfig: Don't set DMA_BOUNCE_UNALIGNED_KMALLOC

If enabled, DMA_BOUNCE_UNALIGNED_KMALLOC causes the swiotlb
buffers (64MB, by default) to be allocated, even on systems
where the DMA controller can reach all of RAM. This is a huge
amount of RAM to waste on a device with only 512MB to start
with, such as the Zero 2 W.

See: https://github.com/raspberrypi/linux/issues/5975

Signed-off-by: Patrick Yavitz <pyavitz@xxxxx.com>
---
 arch/arm64/Kconfig | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/arch/arm64/Kconfig b/arch/arm64/Kconfig
index c9691b0c0f29..f9777ce2ccb2 100644
--- a/arch/arm64/Kconfig
+++ b/arch/arm64/Kconfig
@@ -122,8 +122,7 @@ config ARM64
 	select CRC32
 	select DCACHE_WORD_ACCESS
 	select DYNAMIC_FTRACE if FUNCTION_TRACER
-	# Disable this to save 64MB when DMA controllers can reach all of RAM
-	# select DMA_BOUNCE_UNALIGNED_KMALLOC
+	select DMA_BOUNCE_UNALIGNED_KMALLOC
 	select DMA_DIRECT_REMAP
 	select EDAC_SUPPORT
 	select FRAME_POINTER
-- 
2.39.2

